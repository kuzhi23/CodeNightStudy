<!--
파일 이름은 날짜-카테고리 (예시: 2021-03-21-network.md)
-->

[Node.js]

## nodejs가 무엇인가요? 어디에 사용할 수 있나요?

Node.js는 Javascript를 브라우저 밖에서도 실행할 수 있도록 하는 비동기 이벤트 기반의 Javascript 런타임으로서, 확장성 있는 네트워크 애플리케이션을 만들 수 있도록 설계되어 있습니다.

<br>

**싱글스레드 vs. 멀티스레드**

싱글스레드는 프로세스 내에서 하나의 스레드가 하나의 요청만을 수행합니다. 해당 요청이 수행될 때 다른 요청을 함께 수행할 수 없고, 진행되고 있는 요청이 예정되어 있는 요청을 블로킹하기 때문에 이를 싱글스레드 블로킹 모델이라고 합니다.

멀티스레드는 스레드 풀에서 실행의 요청만큼 스레드를 매칭하여 작업을 수행합니다. 스레드 풀에 스레드가 늘어날수록 CPU 비용을 소모하고, 요청이 적다면 사용하지 않는 스레드가 생긴다는 효율성 측면의 단점을 가지고 있습니다.

## 왜 nodejs 는 single-threaded 인가요

Node.js는 하나의 스레드로 동작하지만, 비동기 I/O 작업을 통해 요청들을 블로킹하지 않는, 싱글스레드 논블로킹 모델입니다. 동시에 많은 요청들을 비동기로 수행하기 때문에, 싱글스레드일지라도 논블로킹이 가능한 것입니다.

또한 Node.js는 클러스터링을 통해 프로세스를 포크하여 멀티스레드인 것처럼 사용될 수 있습니다. 이는 트래픽에 따라 서버의 확장성이 용이하다는 장점을 갖습니다.

## nodejs의 클러스터(cluster)란?

Node.js는 싱글스레드이지만, cluster 모듈을 사용하면 작업을 병렬적으로 처리하도록 하여 손쉽게 멀티 스레드로 구현이 가능합니다. 이를 이용하여 요청을 분산시켜서 서버가 오버로드 되지 않도록 하는 것입니다. 이는 성능 개선에도 큰 효과를 줍니다.

<!-- Node.js는 기본적으로 v8엔진의 제한을 그대로 반영하기 때문에 하나의 프로세스가 사용할 수 있는 메모리의 양이 제한되어 있습니다.  -->

cluster 모듈은 노드가 CPU 코어를 모두 사용할 수 있게 해주는 모듈로서, 기본적으로 클러스터를 사용하면 포트를 공유하는 프로세스들을 생성하게 되고, 포트를 공유하는 노드 프로세스를 여러 개 두어 요청이 많이 들어올 시에 병렬로 실행된 서버의 개수만큼 요청이 분산되게 할 수 있습니다. 따라서 서버 부담을 줄일 수 있습니다.

<br>

**클러스터는 어떻게 동작하나?**

클러스터에는 마스터 프로세스와 워커 프로세스가 있습니다. 마스터 프로세스는 CPU 코어 수 만큼 워커 프로세스를 만들고 8080 포트에서 대기합니다. 8080 포트로 요청이 들어오면, 마스터 프로세스는 워커 프로세스에게 요청을 분배합니다. 워커 프로세스는 실질적으로 일을 하는 프로세스를 말합니다.

<br>

**CPU 코어를 모두 사용한다는 것의 의미?**

코어가 8개인 서버가 있을 경우 노드는 기본적으로 하나의 코어만 활용합니다. 그러나 cluster 모듈을 사용하면 코어 하나 당 노드 프로세스 하나가 돌아가게 할 수 있습니다. 성능이 8배가 되는 것은 아니지만 코어 하나만 사용할 때보다 훨씬 개선되는 것은 사실입니다.

그러나 코어 하나 당 프로세스가 돌아가기 때문에 메모리 세션을 공유하지 못하는데, 이는 Redis 서버를 도입하여 해결할 수 있습니다.





